import{ah as D,r as i,j as e,i as p,n as j,k as C,l as _,g as T,f,p as S,U as P,u as A,a5 as R,s as y,ay as q,az as B,aw as b,V as F,B as w,h as U}from"./index-C7_V5JWq.js";import{T as z,a as V,b as x,c as Y}from"./tabs-BeHpJeVH.js";import{N as $}from"./navigation-DQJChiP-.js";import{P as k}from"./package-6ogy8kt5.js";import{C as H}from"./circle-x-DRqmpjnp.js";import{C as X}from"./circle-check-big-CvtPEX-p.js";import"./index-Mkei7zYV.js";const G=({orderId:c,shopName:n,shopAddress:d})=>{const{deliveryMode:r}=D(),[t,o]=i.useState(null),[u,m]=i.useState(!1);return i.useEffect(()=>{m(!0);const l=setInterval(()=>{o(r==="pickup"?{latitude:28.6139+Math.random()*.001,longitude:77.209+Math.random()*.001,address:d||"Shop Location",estimatedTime:"Ready for pickup"}:{latitude:28.6139+Math.random()*.01,longitude:77.209+Math.random()*.01,address:"Delivery in progress",estimatedTime:`${Math.floor(Math.random()*20+10)} min away`})},3e3);return()=>clearInterval(l)},[r,d]),!u||!t?e.jsx(p,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"h-8 w-8 mx-auto mb-2 animate-spin text-primary"}),e.jsx("p",{children:"Connecting to tracking..."})]})})}):e.jsxs(p,{children:[e.jsx(C,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),r==="pickup"?"Shop Location":"Delivery Tracking"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{variant:r==="pickup"?"secondary":"default",children:r==="pickup"?"Pickup Mode":"Delivery Mode"}),e.jsxs(f,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),t.estimatedTime]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:n}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.address})]}),e.jsx("div",{className:"bg-muted rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Coordinates:"}),e.jsxs("span",{className:"font-mono",children:[t.latitude.toFixed(4),", ",t.longitude.toFixed(4)]})]})}),r==="pickup"?e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("p",{className:"text-green-700 dark:text-green-300 font-medium",children:"Your order is ready for pickup!"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:"Visit the shop at the location above"})]}):e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Rider is on the way!"}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"Track real-time location above"})]})]})]})},ae=()=>{const{user:c}=P(),{toast:n}=A(),{addToCart:d,clearCart:r}=R(),[t,o]=i.useState([]),[u,m]=i.useState(!0),[l,E]=i.useState("all");i.useEffect(()=>{c&&g()},[c]);const g=async()=>{try{m(!0);const{data:s,error:a}=await y.from("orders").select("*").eq("user_id",c==null?void 0:c.id).order("created_at",{ascending:!1});if(a)throw a;const h=(s==null?void 0:s.map(N=>({...N,shop_name:N.shop_name||"Shop"})))||[];o(h)}catch(s){console.error("Error fetching orders:",s),n({title:"Error",description:"Failed to load orders. Please try again.",variant:"destructive"})}finally{m(!1)}},M=async s=>{try{const{error:a}=await y.from("orders").update({status:"cancelled"}).eq("id",s);if(a)throw a;await g(),n({title:"Order Cancelled",description:"Your order has been cancelled successfully."})}catch(a){console.error("Error cancelling order:",a),n({title:"Error",description:"Failed to cancel order. Please try again.",variant:"destructive"})}},O=s=>{r(),s.items.forEach(a=>{d({id:a.product_id||a.id,name:a.name,price:Number(a.price),quantity:Number(a.quantity)||1,shopId:s.shop_id,shopName:s.shop_name||"Shop",imageUrl:a.image_url||"/images/products/default-product.jpg"})}),n({title:"Items added to cart",description:"Review your cart before checkout."})},I=s=>{switch(s){case"delivered":return e.jsx(X,{className:"w-4 h-4"});case"cancelled":return e.jsx(H,{className:"w-4 h-4"});case"out_for_delivery":return e.jsx(k,{className:"w-4 h-4"});default:return e.jsx(S,{className:"w-4 h-4"})}},L=s=>{switch(s){case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"out_for_delivery":return"bg-blue-100 text-blue-800";case"preparing":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},v=s=>s==="all"?t:s==="active"?t.filter(a=>!["delivered","cancelled"].includes(a.status)):t.filter(a=>a.status===s);return u?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary/30 border-t-primary rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading your orders..."})]})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Track and manage your orders"})]}),e.jsxs(z,{value:l,onValueChange:E,className:"space-y-6",children:[e.jsxs(V,{className:"grid w-full grid-cols-4",children:[e.jsx(x,{value:"all",children:"All Orders"}),e.jsx(x,{value:"active",children:"Active"}),e.jsx(x,{value:"delivered",children:"Delivered"}),e.jsx(x,{value:"cancelled",children:"Cancelled"})]}),e.jsx(Y,{value:l,className:"space-y-4",children:v(l).length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No orders found"}),e.jsx("p",{className:"text-muted-foreground",children:l==="all"?"You haven't placed any orders yet.":`No ${l} orders found.`})]}):v(l).map(s=>e.jsxs(p,{className:"overflow-hidden",children:[e.jsx(C,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(_,{className:"text-lg",children:["Order #",s.id.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.shop_name," â€¢ ",q(s.created_at)]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(f,{className:`${L(s.status)} flex items-center gap-1`,children:[I(s.status),B[s.status]]})})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Items:"}),s.items.map((a,h)=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-sm",children:[a.quantity,"x ",a.name]}),e.jsx("span",{className:"text-sm font-medium",children:b(a.price*a.quantity)})]},h))]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"w-4 h-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Delivery Address:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.delivery_address})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Phone:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone_number})]})]}),s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Special Instructions:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.notes})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",children:b(s.total_amount)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Est. delivery: ",s.estimated_delivery_time]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>M(s.id),children:"Cancel Order"}),s.status==="delivered"&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>O(s),children:[e.jsx(U,{className:"w-4 h-4 mr-1"})," Reorder"]})]})]}),!["delivered","cancelled"].includes(s.status)&&e.jsx("div",{className:"mt-4",children:e.jsx(G,{orderId:s.id,shopName:s.shop_name||"Unknown Shop",shopAddress:s.delivery_address})})]})]},s.id))})]})]})})};export{ae as default};
