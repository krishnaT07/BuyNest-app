import{r as c,f as y,s as i}from"./index-CErRD7Zr.js";const q=()=>{const[g,w]=c.useState([]),[S,n]=c.useState(!0),[_,l]=c.useState(null),{user:s}=y(),a=async()=>{if(!s){n(!1);return}try{n(!0),l(null);const{data:e,error:r}=await i.from("shops").select("id").eq("owner_id",s.id);if(r)throw r;if(!e||e.length===0){w([]),n(!1);return}const o=e[0].id,{data:p,error:d}=await i.from("products").select("*").eq("shop_id",o).order("created_at",{ascending:!1});if(d)throw d;const f=(p||[]).map(t=>({id:t.id,name:t.name,description:t.description||"",price:Number(t.price),originalPrice:t.original_price?Number(t.original_price):void 0,category:t.category||"",imageUrl:t.image_url||"",inStock:t.in_stock??!0,stockQuantity:t.stock_quantity||0,isActive:t.is_active??!0,shopId:t.shop_id,sku:t.sku||"",weight:t.weight||"",nutritionInfo:t.nutrition_info||null,isFeatured:t.is_featured??!1,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}));w(f)}catch(e){console.error("Error fetching seller products:",e),l("Failed to load products")}finally{n(!1)}},m=async e=>{if(console.log("Creating product - User:",s),!s)throw console.error("No user found in context"),new Error("User not authenticated");try{console.log("Fetching shop for user:",s.id);const{data:r,error:o}=await i.from("shops").select("id").eq("owner_id",s.id).maybeSingle();if(console.log("Shop query result:",{shops:r,shopError:o}),o)throw console.error("Shop error:",o),o;if(!r)throw console.error("No shop found for user"),new Error("No shop found for seller");const p={id:`prod-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:e.name,description:e.description,price:e.price,original_price:e.originalPrice,category:e.category,image_url:e.imageUrl,in_stock:e.inStock,shop_id:r.id,sku:e.sku,weight:e.weight,nutrition_info:e.nutritionInfo,is_featured:e.isFeatured};console.log("Creating product with payload:",p);const{data:d,error:f}=await i.from("products").insert(p).select().single();if(console.log("Product creation result:",{data:d,error:f}),f)throw f;return await a(),d}catch(r){throw console.error("Error in createProduct:",r),r}},u=async(e,r)=>{const{error:o}=await i.from("products").update({name:r.name,description:r.description,price:r.price,original_price:r.originalPrice,category:r.category,image_url:r.imageUrl,in_stock:r.inStock,sku:r.sku,weight:r.weight,nutrition_info:r.nutritionInfo,is_featured:r.isFeatured}).eq("id",e);if(o)throw o;await a()},h=async e=>{const{error:r}=await i.from("products").delete().eq("id",e);if(r)throw r;await a()};return c.useEffect(()=>{a()},[s]),{products:g,loading:S,error:_,createProduct:m,updateProduct:u,deleteProduct:h,updateStock:async(e,r)=>{try{const{error:o}=await i.from("products").update({stock_quantity:r,in_stock:r>0}).eq("id",e);if(o)throw o;await a()}catch(o){throw console.error("Error updating stock:",o),o}},toggleProductStatus:async(e,r)=>{try{const{error:o}=await i.from("products").update({is_active:r}).eq("id",e);if(o)throw o;await a()}catch(o){throw console.error("Error toggling product status:",o),o}},refetch:a}},F=()=>{const[g,w]=c.useState(null),[S,n]=c.useState(!0),[_,l]=c.useState(null),{user:s}=y();return c.useEffect(()=>{(async()=>{if(!s){n(!1);return}try{n(!0),l(null);const{data:u,error:h}=await i.from("shops").select("*").eq("owner_id",s.id).single();if(h&&h.code!=="PGRST116")throw h;w(u)}catch(u){console.error("Error fetching seller shop:",u),l("Failed to load shop")}finally{n(!1)}})()},[s]),{shop:g,loading:S,error:_,hasShop:()=>g!==null,refetch:()=>fetchSellerShop()}};export{F as a,q as u};
