import{c as T,d as ce,a5 as de,U as le,av as oe,ah as me,u as pe,r as n,j as e,h as R,B as j,i as y,k as f,l as g,aj as xe,T as he,n as N,f as W,b as m,aw as l,I as H,ax as ue,g as je,a4 as ye,s as q}from"./index-C7_V5JWq.js";import{T as fe}from"./textarea-B3eKeinw.js";import{S as E}from"./separator-DHEMzE8V.js";import{L as ge}from"./LocationInput-C6dYuTVz.js";import"./navigation-DQJChiP-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=T("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=T("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=T("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=T("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Te=()=>{const v=ce(),{items:J,totalPrice:p,clearCart:M,getCartByShop:K}=de(),{user:a}=le(),{addresses:B}=oe(),{deliveryMode:r}=me(),{toast:h}=pe(),[D,L]=n.useState(!1),[u,b]=n.useState(""),[k,A]=n.useState(""),[$,V]=n.useState(""),[w,F]=n.useState("card"),[Y,X]=n.useState(""),[C,Z]=n.useState(!1),[I,ee]=n.useState(null),[P,se]=n.useState(0),[O,re]=n.useState(!1),[ae,te]=n.useState(null),_=K(),ne=Object.keys(_);n.useEffect(()=>{a&&(!u&&a.address&&b(a.address),!k&&a.phone&&A(a.phone))},[a]);const ie=async()=>{if(!a){h({title:"Authentication Required",description:"Please log in to place an order.",variant:"destructive"}),v("/auth/login");return}const s=r!=="pickup";if(s&&!u.trim()||!k.trim()){h({title:"Missing Information",description:s?"Please fill in your delivery address and phone number.":"Please enter your phone number.",variant:"destructive"});return}L(!0);try{const i=ne.map(d=>{const o=_[d],x=o.reduce((c,S)=>c+S.price*S.quantity,0);return{user_id:a.id,shop_id:d,items:o.map(c=>({product_id:c.id,name:c.name,price:c.price,quantity:c.quantity,image_url:c.imageUrl})),total_amount:x,status:"pending",delivery_address:s?u:"Pickup at shop",phone_number:k,notes:$||null,estimated_delivery_time:r==="pickup"?"Ready for pickup":"30-45 minutes",payment_method:w}});if(w==="card"){const d=Math.round(p*100);try{const{data:o,error:x}=await q.functions.invoke("create-payment",{body:{amount:d,currency:"usd",orders:i}});if(x)throw x;if(o!=null&&o.url){M(),window.location.href=o.url;return}throw new Error("Payment session could not be created")}catch{const x=i.map(S=>({...S,payment_method:"card_pending"})),{error:c}=await q.from("orders").insert(x);if(c)throw c;M(),h({title:"Payment Pending",description:"We could not initiate card payment due to a network issue. Your orders were created as pending. You can complete payment with the shop."}),v("/orders");return}}const{error:t}=await q.from("orders").insert(i);if(t)throw t;M(),h({title:"Order Placed!",description:"Your order has been placed successfully!"}),v("/orders")}catch(i){console.error("Order placement error:",i),h({title:"Order Failed",description:"There was an error placing your order. Please try again.",variant:"destructive"})}finally{L(!1)}};if(J.length===0)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(R,{className:"w-16 h-16 mx-auto text-muted-foreground"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Your cart is empty"}),e.jsx("p",{className:"text-muted-foreground",children:"Add some items to get started!"}),e.jsx(j,{onClick:()=>v("/browse"),children:"Browse Shops"})]})})});const z=C?Math.min(p*.1,100):0,G=O?19:0,U=Math.max(0,p-z)+P+G;return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"h-2 flex-1 rounded bg-muted",children:e.jsx("div",{className:"h-2 w-2/3 bg-primary rounded"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"2 of 3"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Cart"}),e.jsx("span",{children:"›"}),e.jsx("span",{className:"font-medium text-foreground",children:"Checkout"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:"Payment"})]}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight mt-4",children:"Checkout"}),e.jsx("p",{className:"text-muted-foreground",children:"Review your order and complete your purchase"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[r==="pickup"?e.jsx(xe,{className:"w-5 h-5"}):e.jsx(he,{className:"w-5 h-5"}),r==="pickup"?"Pickup Order":"Delivery Order"]})}),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{variant:r==="pickup"?"secondary":"default",children:r==="pickup"?"Self Pickup":"Home Delivery"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r==="pickup"?"You will collect your order from the shop":"Your order will be delivered to your address"})]}),r!=="pickup"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(m,{className:"text-sm mb-2 block",children:"Delivery Slot"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["Today 4-6 PM","Today 6-8 PM","Tomorrow 10-12 AM","Tomorrow 12-2 PM","Tomorrow 4-6 PM","Express 30-45 min"].map(s=>e.jsx("button",{onClick:()=>te(s),className:`p-2 text-sm rounded border ${ae===s?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3 w-3"}),s]})},s))})]})]})]}),e.jsxs(y,{children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Order Summary"]})}),e.jsxs(N,{className:"space-y-4",children:[Object.entries(_).map(([s,i])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:i[0].shopName}),e.jsxs(W,{variant:"secondary",children:[i.length," item",i.length!==1?"s":""]})]}),i.map(t=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.imageUrl||"/images/products/default-product.jpg",alt:t.name,className:"w-12 h-12 rounded-lg object-cover",loading:"lazy",decoding:"async",onError:d=>{d.currentTarget.src="/images/products/default-product.jpg"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Qty: ",t.quantity]})]})]}),e.jsx("p",{className:"font-semibold",children:l(t.price*t.quantity)})]},t.id)),e.jsx(E,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Shop Total:"}),e.jsx("span",{children:l(i.reduce((t,d)=>t+d.price*d.quantity,0))})]})]},s)),e.jsxs("div",{className:"mt-4 p-3 rounded-lg border bg-muted/30",children:[e.jsxs(m,{className:"text-sm mb-2 flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Apply Coupon"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{placeholder:"Enter coupon code",value:Y,onChange:s=>X(s.target.value)}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>{const s=ue(Y,p);Z(s.valid),ee(s.message),s.valid},children:C?"Applied":"Apply"})]}),I&&e.jsx("p",{className:`text-xs mt-1 ${C?"text-green-600":"text-destructive"}`,children:I})]}),e.jsx(E,{className:"my-4"}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:l(p)})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),r==="pickup"?"Contact Information":"Delivery Information"]})}),e.jsxs(N,{className:"space-y-4",children:[a&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>{a.address&&b(a.address),a.phone&&A(a.phone)},children:"Use saved details"}),e.jsx("span",{className:"text-muted-foreground",children:"Fill from profile"})]}),e.jsx(ge,{label:r==="pickup"?"Pickup Location":"Delivery Address",value:u,onChange:b,placeholder:r==="pickup"?"Shop address will be provided after order confirmation...":"Enter your full delivery address...",disabled:r==="pickup",required:r!=="pickup",helperText:r==="pickup"?"Shop location will be shared after order confirmation":"Click 'Use Current Location' or enter address manually"}),B.length>0&&r!=="pickup"&&e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"Choose a saved address"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2 mt-2",children:B.map(s=>e.jsxs("button",{className:`p-2 text-left rounded border ${u===s.line1?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>b(s.line1),children:[e.jsx("p",{className:"font-medium text-sm",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.line1})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"phone",children:"Phone Number"}),e.jsx(H,{id:"phone",type:"tel",placeholder:"Your phone number",value:k,onChange:s=>A(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"notes",children:"Special Instructions (Optional)"}),e.jsx(fe,{id:"notes",placeholder:"Any special delivery instructions...",value:$,onChange:s=>V(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"gift",type:"checkbox",checked:O,onChange:s=>re(s.target.checked)}),e.jsxs(m,{htmlFor:"gift",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Add gift wrap (₹19)"]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"Tip your delivery partner (optional)"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[0,10,20,50].map(s=>e.jsx(j,{type:"button",variant:P===s?"default":"outline",size:"sm",onClick:()=>se(s),children:s===0?"No tip":`₹${s}`},s))})]})]})]}),e.jsxs(y,{children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Payment Method"]})}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{className:`p-4 border rounded-lg text-left transition-colors ${w==="card"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>F("card"),children:[e.jsx(Q,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"font-medium",children:"Card Payment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pay with debit/credit card"})]}),e.jsxs("button",{className:`p-4 border rounded-lg text-left transition-colors ${w==="cash"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>F("cash"),children:[e.jsx("div",{className:"w-6 h-6 mb-2 bg-accent rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-accent-foreground",children:"$"})}),e.jsx("p",{className:"font-medium",children:"Cash on Delivery"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pay when order arrives"})]})]})})]}),e.jsxs(y,{className:"sticky top-8",children:[e.jsx(f,{children:e.jsx(g,{children:"Payment Summary"})}),e.jsxs(N,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Items subtotal"}),e.jsx("span",{children:l(p)})]}),C&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Coupon discount"}),e.jsxs("span",{children:["-",l(z)]})]}),O&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gift wrap"}),e.jsx("span",{children:l(G)})]}),P>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tip"}),e.jsx("span",{children:l(P)})]}),e.jsx(E,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Grand Total"}),e.jsx("span",{children:l(U)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground pt-2",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Secure checkout • 256-bit SSL encryption"})]}),e.jsx(j,{onClick:ie,disabled:D,className:"w-full h-12 text-lg bg-gradient-hero hover:shadow-strong transform hover:scale-105 transition-all duration-300",children:D?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Place Order • ${l(U)}`})]})]})]})]})]})})};export{Te as default};
