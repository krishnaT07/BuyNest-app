import{r as f,U as P,s as n}from"./index-C7_V5JWq.js";const S=()=>{const[g,h]=f.useState([]),[w,l]=f.useState(!0),[m,u]=f.useState(null),{user:t}=P(),s=async()=>{if(!t){l(!1);return}try{l(!0),u(null);const{data:e,error:r}=await n.from("shops").select("id").eq("owner_id",t.id);if(r)throw r;if(!e||e.length===0){h([]),l(!1);return}const i=e[0].id,{data:d,error:a}=await n.from("products").select("*").eq("shop_id",i).order("created_at",{ascending:!1});if(a)throw a;const c=(d||[]).map(o=>({id:o.id,name:o.name,description:o.description||"",price:Number(o.price),originalPrice:o.original_price?Number(o.original_price):void 0,category:o.category||"",imageUrl:o.image_url||"",inStock:o.in_stock??!0,shopId:o.shop_id,sku:o.sku||"",weight:o.weight||"",nutritionInfo:o.nutrition_info||null,isFeatured:o.is_featured??!1,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)}));h(c)}catch(e){console.error("Error fetching seller products:",e),u("Failed to load products")}finally{l(!1)}},_=async e=>{if(console.log("Creating product - User:",t),!t)throw console.error("No user found in context"),new Error("User not authenticated");try{console.log("Fetching shop for user:",t.id);const{data:r,error:i}=await n.from("shops").select("id").eq("owner_id",t.id).maybeSingle();if(console.log("Shop query result:",{shops:r,shopError:i}),i)throw console.error("Shop error:",i),i;if(!r)throw console.error("No shop found for user"),new Error("No shop found for seller");const d={id:`prod-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:e.name,description:e.description,price:e.price,original_price:e.originalPrice,category:e.category,image_url:e.imageUrl,in_stock:e.inStock,shop_id:r.id,sku:e.sku,weight:e.weight,nutrition_info:e.nutritionInfo,is_featured:e.isFeatured};console.log("Creating product with payload:",d);const{data:a,error:c}=await n.from("products").insert(d).select().single();if(console.log("Product creation result:",{data:a,error:c}),c)throw c;return await s(),a}catch(r){throw console.error("Error in createProduct:",r),r}},p=async(e,r)=>{const{error:i}=await n.from("products").update({name:r.name,description:r.description,price:r.price,original_price:r.originalPrice,category:r.category,image_url:r.imageUrl,in_stock:r.inStock,sku:r.sku,weight:r.weight,nutrition_info:r.nutritionInfo,is_featured:r.isFeatured}).eq("id",e);if(i)throw i;await s()},y=async e=>{const{error:r}=await n.from("products").delete().eq("id",e);if(r)throw r;await s()};return f.useEffect(()=>{s()},[t]),{products:g,loading:w,error:m,createProduct:_,updateProduct:p,deleteProduct:y,refetch:s}};export{S as u};
