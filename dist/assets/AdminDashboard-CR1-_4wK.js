import{r as j,s as m,u as F,a3 as G,S as k,j as e,a4 as I,f as N,B as O,i as y,n as b,k as _,l as C,m as A,g as H,V as q}from"./index-C7_V5JWq.js";import{T as J,a as V,b as E,c as L}from"./tabs-BeHpJeVH.js";import{C as X,T as D,a as P,b as T,c as o,d as R,e as h,E as K}from"./table-PbWUxb21.js";import{P as Q}from"./package-6ogy8kt5.js";import{C as Y}from"./circle-check-big-CvtPEX-p.js";import{C as Z}from"./circle-x-DRqmpjnp.js";import"./index-Mkei7zYV.js";const ee=()=>{const[v,w]=j.useState([]),[f,x]=j.useState(!0),[p,d]=j.useState(null),r=async()=>{try{x(!0),d(null);const{data:i,error:a}=await m.from("shops").select("*").eq("is_approved",!1).order("created_at",{ascending:!1});if(a)throw a;const l=await Promise.all(i.map(async c=>{const{data:g}=await m.from("profiles").select("name").eq("user_id",c.owner_id).single();return{...c,owner_name:(g==null?void 0:g.name)||"Unknown"}}));w(l)}catch(i){console.error("Error fetching pending shops:",i),d("Failed to load pending shops")}finally{x(!1)}},n=async i=>{var a;try{const{error:l}=await m.from("shops").update({is_approved:!0,approved_at:new Date().toISOString(),approved_by:(a=(await m.auth.getUser()).data.user)==null?void 0:a.id}).eq("id",i);if(l)throw l;return await r(),!0}catch(l){throw console.error("Error approving shop:",l),l}},t=async i=>{try{const{error:a}=await m.from("shops").delete().eq("id",i);if(a)throw a;return await r(),!0}catch(a){throw console.error("Error rejecting shop:",a),a}};return j.useEffect(()=>{r()},[]),{pendingShops:v,loading:f,error:p,approveShop:n,rejectShop:t,refetch:r}},se=()=>{const[v,w]=j.useState({totalUsers:0,activeSellers:0,totalOrders:0,platformRevenue:0,usersChange:"+0%",sellersChange:"+0%",ordersChange:"+0%",revenueChange:"+0%"}),[f,x]=j.useState(!0),p=async()=>{try{x(!0);const{count:d}=await m.from("profiles").select("*",{count:"exact",head:!0}),{count:r}=await m.from("shops").select("*",{count:"exact",head:!0}).eq("is_approved",!0),{count:n}=await m.from("orders").select("*",{count:"exact",head:!0}),{data:t}=await m.from("orders").select("total_amount").eq("status","delivered"),i=(t==null?void 0:t.reduce((a,l)=>a+Number(l.total_amount),0))||0;w({totalUsers:d||0,activeSellers:r||0,totalOrders:n||0,platformRevenue:i,usersChange:"+12%",sellersChange:"+8%",ordersChange:"+15%",revenueChange:"+23%"})}catch(d){console.error("Error fetching admin stats:",d)}finally{x(!1)}};return j.useEffect(()=>{p()},[]),{stats:v,loading:f,refetch:p}},re=()=>{const[v,w]=j.useState([]),[f,x]=j.useState(!0),p=async()=>{try{x(!0);const{data:d}=await m.from("profiles").select("*").order("created_at",{ascending:!1});if(!d)return;const r=await Promise.all(d.map(async n=>{const{data:t}=await m.from("user_roles").select("role").eq("user_id",n.user_id);return{id:n.user_id,name:n.name,phone:n.phone,address:n.address,is_verified:n.is_verified,created_at:n.created_at,roles:(t==null?void 0:t.map(i=>i.role))||["user"]}}));w(r)}catch(d){console.error("Error fetching users:",d)}finally{x(!1)}};return j.useEffect(()=>{p()},[]),{users:v,loading:f,refetch:p}},te=()=>{const[v,w]=j.useState([]),[f,x]=j.useState(!0),p=async()=>{try{x(!0);const{data:r}=await m.from("orders").select("*").order("created_at",{ascending:!1}).limit(50);if(!r)return;const n=await Promise.all(r.map(async t=>{const{data:i}=await m.from("profiles").select("name").eq("user_id",t.user_id).single(),{data:a}=await m.from("shops").select("name").eq("id",t.shop_id).single();return{...t,customer_name:(i==null?void 0:i.name)||"Unknown",shop_name:(a==null?void 0:a.name)||"Unknown Shop"}}));w(n)}catch(r){console.error("Error fetching orders:",r)}finally{x(!1)}},d=async(r,n)=>{try{const{error:t}=await m.from("orders").update({status:n,updated_at:new Date().toISOString()}).eq("id",r);if(t)throw t;await p()}catch(t){throw console.error("Error updating order status:",t),t}};return j.useEffect(()=>{p()},[]),{orders:v,loading:f,updateOrderStatus:d,refetch:p}},ae=()=>{const[v,w]=j.useState([]),[f,x]=j.useState(!0),p=async()=>{var n;try{x(!0);const t=[],{data:i}=await m.from("orders").select("id, status, created_at, shop_id").order("created_at",{ascending:!1}).limit(10);if(i)for(const c of i){const{data:g}=await m.from("shops").select("name").eq("id",c.shop_id).single();t.push({id:`order-${c.id}`,type:"order",message:`New order ${c.id.slice(0,8)} placed at ${(g==null?void 0:g.name)||"Unknown Shop"}`,time:d(c.created_at),status:c.status==="delivered"?"success":"pending"})}const{data:a}=await m.from("shops").select("id, name, created_at, is_approved").order("created_at",{ascending:!1}).limit(5);a&&a.forEach(c=>{t.push({id:`shop-${c.id}`,type:"seller",message:`${c.name} requested shop verification`,time:d(c.created_at),status:c.is_approved?"success":"pending"})});const{data:l}=await m.from("profiles").select("id, name, created_at").order("created_at",{ascending:!1}).limit(3);l&&t.push({id:"users-today",type:"user",message:`${l.length} new users registered recently`,time:d((n=l[0])==null?void 0:n.created_at),status:"info"}),t.sort((c,g)=>{const U=r(c.time),S=r(g.time);return U-S}),w(t.slice(0,10))}catch(t){console.error("Error fetching activities:",t)}finally{x(!1)}},d=n=>{const t=new Date(n),a=new Date().getTime()-t.getTime(),l=Math.floor(a/(1e3*60)),c=Math.floor(a/(1e3*60*60)),g=Math.floor(a/(1e3*60*60*24));return l<1?"Just now":l<60?`${l} mins ago`:c<24?`${c} hours ago`:`${g} days ago`},r=n=>{if(n==="Just now")return 0;const t=n.match(/(\d+)\s+(mins?|hours?|days?)/);if(!t)return 0;const i=parseInt(t[1]),a=t[2];return a.startsWith("min")?i:a.startsWith("hour")?i*60:a.startsWith("day")?i*60*24:0};return j.useEffect(()=>{p()},[]),{activities:v,loading:f,refetch:p}},me=()=>{const[v,w]=j.useState("overview"),{pendingShops:f,loading:x,approveShop:p,rejectShop:d}=ee(),{stats:r,loading:n}=se(),{users:t,loading:i}=re(),{orders:a,loading:l,updateOrderStatus:c}=te(),{activities:g,loading:U}=ae(),{toast:S}=F(),$=[{title:"Total Users",value:n?"...":r.totalUsers.toString(),change:r.usersChange,icon:G},{title:"Active Sellers",value:n?"...":r.activeSellers.toString(),change:r.sellersChange,icon:k},{title:"Total Orders",value:n?"...":r.totalOrders.toString(),change:r.ordersChange,icon:Q},{title:"Platform Revenue",value:n?"...":`₹${r.platformRevenue.toLocaleString()}`,change:r.revenueChange,icon:X}],B=async(s,u)=>{try{await c(s,u),S({title:"Order updated",description:`Order status changed to ${u}`})}catch{S({title:"Error",description:"Failed to update order status",variant:"destructive"})}},W=async s=>{try{await p(s),S({title:"Shop approved!",description:"The shop has been approved and can now start selling."})}catch{S({title:"Error",description:"Failed to approve shop. Please try again.",variant:"destructive"})}},z=async s=>{try{await d(s),S({title:"Shop rejected",description:"The shop has been rejected and removed."})}catch{S({title:"Error",description:"Failed to reject shop. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-card border-b border-border sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(I,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"BuyNest Platform Management"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{variant:"secondary",children:"Super Admin"}),e.jsx(O,{variant:"ghost",children:"Profile"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(J,{value:v,onValueChange:w,children:[e.jsxs(V,{className:"grid w-full grid-cols-5",children:[e.jsx(E,{value:"overview",children:"Overview"}),e.jsx(E,{value:"users",children:"Users"}),e.jsx(E,{value:"sellers",children:"Sellers"}),e.jsx(E,{value:"orders",children:"Orders"}),e.jsx(E,{value:"reports",children:"Reports"})]}),e.jsxs(L,{value:"overview",className:"space-y-6",children:[e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-6",children:$.map((s,u)=>{const M=s.icon;return e.jsx(y,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.value}),e.jsxs("p",{className:"text-sm text-green-600",children:[s.change," from last month"]})]}),e.jsx(M,{className:"w-8 h-8 text-muted-foreground"})]})})},u)})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(y,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Pending Shop Approvals"}),e.jsx(A,{children:"Shops waiting for verification"})]}),e.jsx(N,{variant:"secondary",children:f.length})]}),e.jsx(b,{className:"space-y-4",children:x?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading pending shops..."})]}):f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"No shops pending approval"})]}):f.map(s=>{var u;return e.jsxs("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Owner: ",s.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:((u=s.categories)==null?void 0:u[0])||"No category"}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),s.address]}),s.phone&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),s.phone]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(N,{variant:"outline",className:"text-xs",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(O,{size:"sm",variant:"default",className:"flex-1",onClick:()=>W(s.id),children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Approve"]}),e.jsxs(O,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>z(s.id),children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Reject"]})]})]},s.id)})})]}),e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Recent Activity"}),e.jsx(A,{children:"Latest platform events"})]}),e.jsx(b,{className:"space-y-4",children:U?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"})}):g.map((s,u)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${s.status==="success"?"bg-green-500":s.status==="warning"?"bg-yellow-500":s.status==="pending"?"bg-blue-500":"bg-gray-500"}`}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time})]})]},u))})]})]})]}),e.jsx(L,{value:"users",children:e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"User Management"}),e.jsx(A,{children:"Manage platform users and buyers"})]}),e.jsx(b,{children:i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading users..."})]}):e.jsxs(D,{children:[e.jsx(P,{children:e.jsxs(T,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Phone"}),e.jsx(o,{children:"Address"}),e.jsx(o,{children:"Roles"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Joined"})]})}),e.jsx(R,{children:t.map(s=>e.jsxs(T,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.phone||"N/A"}),e.jsx(h,{children:s.address||"N/A"}),e.jsx(h,{children:e.jsx("div",{className:"flex gap-1",children:s.roles.map(u=>e.jsx(N,{variant:"secondary",className:"text-xs",children:u},u))})}),e.jsx(h,{children:e.jsx(N,{variant:s.is_verified?"default":"secondary",children:s.is_verified?"Verified":"Unverified"})}),e.jsx(h,{children:new Date(s.created_at).toLocaleDateString()})]},s.id))})]})})]})}),e.jsx(L,{value:"sellers",children:e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Seller Management"}),e.jsx(A,{children:"Manage shops and seller accounts"})]}),e.jsx(b,{children:x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading shops..."})]}):e.jsxs(D,{children:[e.jsx(P,{children:e.jsxs(T,{children:[e.jsx(o,{children:"Shop Name"}),e.jsx(o,{children:"Owner"}),e.jsx(o,{children:"Category"}),e.jsx(o,{children:"Contact"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Created"})]})}),e.jsx(R,{children:f.map(s=>{var u;return e.jsxs(T,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.owner_name}),e.jsx(h,{children:((u=s.categories)==null?void 0:u[0])||"N/A"}),e.jsx(h,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),s.phone]}),e.jsx("div",{className:"text-muted-foreground",children:s.email})]})}),e.jsx(h,{children:e.jsx(N,{variant:"outline",children:"Pending"})}),e.jsx(h,{children:new Date(s.created_at).toLocaleDateString()})]},s.id)})})]})})]})}),e.jsx(L,{value:"orders",children:e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Order Monitoring"}),e.jsx(A,{children:"Monitor all platform orders"})]}),e.jsx(b,{children:l?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading orders..."})]}):e.jsxs(D,{children:[e.jsx(P,{children:e.jsxs(T,{children:[e.jsx(o,{children:"Order ID"}),e.jsx(o,{children:"Customer"}),e.jsx(o,{children:"Shop"}),e.jsx(o,{children:"Amount"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(R,{children:a.map(s=>e.jsxs(T,{children:[e.jsxs(h,{className:"font-mono text-sm",children:[s.id.slice(0,8),"..."]}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customer_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.phone_number})]})}),e.jsx(h,{children:s.shop_name}),e.jsxs(h,{children:["₹",s.total_amount]}),e.jsx(h,{children:e.jsx(N,{variant:s.status==="delivered"?"default":s.status==="cancelled"?"destructive":s.status==="confirmed"?"secondary":"outline",children:s.status})}),e.jsx(h,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsx(O,{size:"sm",variant:"outline",onClick:()=>B(s.id,"confirmed"),children:"Confirm"}),e.jsx(O,{size:"sm",variant:"ghost",children:e.jsx(K,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})}),e.jsx(L,{value:"reports",children:e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Reports & Analytics"}),e.jsx(A,{children:"Platform analytics and reports"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(C,{className:"text-lg",children:"Revenue Overview"})}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["₹",r.platformRevenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Total platform revenue"}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Orders Completed"}),e.jsx("span",{children:r.totalOrders})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Active Sellers"}),e.jsx("span",{children:r.activeSellers})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Users"}),e.jsx("span",{children:r.totalUsers})]})]})]})]}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(C,{className:"text-lg",children:"Growth Metrics"})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"User Growth"}),e.jsx(N,{variant:"secondary",children:r.usersChange})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Seller Growth"}),e.jsx(N,{variant:"secondary",children:r.sellersChange})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Order Growth"}),e.jsx(N,{variant:"secondary",children:r.ordersChange})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Revenue Growth"}),e.jsx(N,{variant:"secondary",children:r.revenueChange})]})]})})]})]})})]})})]})})]})};export{me as default};
